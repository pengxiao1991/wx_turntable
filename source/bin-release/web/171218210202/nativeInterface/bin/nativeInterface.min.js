var win=window,callbacks={},listeners={},GlobalCallbackName='WelFareHybridCallBack',uuid=(Math.random()*1000000)|0;function _invoke(id,method,args){if(win.androidJs){win.androidJs.doAndroidAction(id,method,!!args?JSON.stringify(args):'',GlobalCallbackName)}else{console.log('不在webview运行环境','androidJs.doAndroidAction('+id+', '+method+', '+(!!args?JSON.stringify(args):'""')+','+GlobalCallbackName+')')}}function _syncInvoke(id,method,args){if(win.androidJs){return win.androidJs.doAndroidAction(id,method,!!args?JSON.stringify(args):'')}else{console.log('不在webview运行环境','androidJs.doAndroidAction('+id+', '+method+', '+(!!args?JSON.stringify(args):'""')+')')}}function getUuid(){uuid+=1;return uuid}win[GlobalCallbackName]=function(ret){var actionId=ret['actionId'],response=ret['response']['data'],key,itm;if(callbacks.hasOwnProperty(actionId)){if(callbacks[actionId]){callbacks[actionId](response);delete callbacks[actionId]}}else{for(key in listeners){itm=listeners[key];if(itm.id==actionId){var result=itm['cbs'][itm['cbs'].length-1](response);if(result===false||result===true){return result}return}}}};function invoke(method,args,callback){var id=getUuid();if(callback){callbacks[id]=callback}_invoke(id,method,args)}function syncInvoke(method,args){var id=getUuid();var result=_syncInvoke(id,method,args);if(!!result){result=JSON.parse(result);return result.response['data']}}function listen(method,args,callback){var cbs,id;if(!listeners.hasOwnProperty(method)){id=getUuid();listeners[method]={'id':id,'cbs':[callback]};_invoke(id,method,args)}else{listeners[method]['cbs'].push(callback)}}function removeListen(method,cb,rmvListenerMethod){if(!!listeners[method]){var cbs=listeners[method]['cbs'],index=-1;cbs.forEach(function(icb,i){if(icb===cb){index=i}});if(index!==-1){cbs.splice(index,1)}if(cbs.length===0){delete listeners[method];syncInvoke(rmvListenerMethod)}}}var Lib={'isPrd':!!win.androidJs,'invoke':invoke,'syncInvoke':syncInvoke,'listen':listen,'removeListen':removeListen};var win=window,_={'tokenCb':null,'token':null};function showNativeDialog(json,cb){if(!!win.androidJs){Lib.invoke('showDialog',json,cb)}else{console.log('try to shownativedialog')}}function showNativeToast(json){if(!!win.androidJs){Lib.syncInvoke('androidToast',json)}else{console.log('try to shownativetoast')}}function startLoading(msg){Lib.syncInvoke('startLoading',{'message':msg})}function stopLoading(){Lib.syncInvoke('stopLoading')}function bindBackListener(handler){if(!!win.androidJs){Lib.listen('addBackPressListener',null,handler)}}function unBindBackListener(handler){Lib.removeListen('addBackPressListener',handler,'removeBackPressListener')}function finishPage(){Lib.syncInvoke('back')}function isLogin(){if(!!mock.accessToken){return{'isLogin':true}}return Lib.syncInvoke('isLogin')}function getToken(cb,force){if(!!mock.accessToken){return cb(mock.accessToken)}if(force){delete _.token}if(!!_.token){cb(_.token)}else{if(force||!isLogin().isLogin){_.tokenCb=cb;Lib.invoke('getTokenAsync',{"invalidToken":true},function(ret){_.tokenCb(_.token=!!ret?ret['mzToken']:undefined);delete _.tokenCb})}else{cb(_.token=Lib.syncInvoke('getTokenSync',{"invalidToken":false}).mzToken)}}}function getTokenFromCache(){if(!!mock.accessToken){return mock.accessToken}return _.token}function getUserInfo(){return Lib.syncInvoke('getUserInfo','')}function getDeviceInfo(){if(!!mock.imei){return{'i':mock.imei}}return!!this.deviceInfo?this.deviceInfo:(this.deviceInfo=Lib.syncInvoke('getDeviceInfo',''))}function initAndroidEnv(fn){getToken(fn,false)}function setStatusbarStyle(args){Lib.syncInvoke('setStatusbarStyle',args)}var mock={'accessToken':undefined,'imei':undefined};function mockLogin(token,imei){if(!window.androidJs){mock['accessToken']=token;mock['imei']=imei}}function clearMockLogin(){mock.accessToken=undefined;mock.accessToken=undefined}function addNetworkListener(cb){if(!!win.androidJs){Lib.listen('addNetworkListener',null,cb)}}function removeNetworkListener(cb){Lib.removeListen('addNetworkListener',cb,'removeNetworkListener')}function markCoinChanged(){Lib.syncInvoke('markCoinChanged')}function bindStartStopScreenListener(handler){if(!!win.androidJs){Lib.listen('addStartStopListener',null,handler)}}function unBindStartStopScreenListener(handler){Lib.removeListen('addStartStopListener',handler,'removeStartStopListener')}var native={'clearMockLogin':clearMockLogin,'mockLogin':mockLogin,'getToken':getToken,'getTokenFromCache':getTokenFromCache,'initAndroidEnv':initAndroidEnv,'bindBackListener':bindBackListener,'unBindBackListener':unBindBackListener,'finishPage':finishPage,'isLogin':isLogin,'startLoading':startLoading,'stopLoading':stopLoading,'setStatusbarStyle':setStatusbarStyle,'getDeviceInfo':getDeviceInfo,'showNativeDialog':showNativeDialog,'showNativeToast':showNativeToast,'addNetworkListener':addNetworkListener,'removeNetworkListener':removeNetworkListener,'markCoinChanged':markCoinChanged,'bindStartStopScreenListener':bindStartStopScreenListener,'unBindStartStopScreenListener':unBindStartStopScreenListener};window.Native=native;