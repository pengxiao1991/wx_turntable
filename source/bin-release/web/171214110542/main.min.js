var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),GlobalEmitter=function(){function e(){}return e.on=function(t,n,o,i){void 0===i&&(i=!1),e.listeners[t]||(e.listeners[t]=[]),e.listeners[t].push({name:t,callback:n,target:o,justOnce:i})},e.once=function(t,n,o){e.on(t,n,o,!0)},e.remove=function(t,n){var o=e.listeners[t];if(o)if(n){for(var i=o.length,r=0;i>r;r++){var s=o[r];if(n==s.callback){o.splice(r,1);break}}0==o.length&&delete e.listeners[t]}else delete e.listeners[t]},e.emit=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var i=e.listeners[t];return i?void i.forEach(function(t){t.callback&&((o=t.callback).call.apply(o,[t.target].concat(n)),t.justOnce&&e.remove(t.name,t.callback));var o}):void console.error(t+"事件没有注册，无法调用emit方法")},e.listeners={},e}();__reflect(GlobalEmitter.prototype,"GlobalEmitter");var GlobalEvent;!function(e){e.NEW_GAME_OPENING="NEW_GAME_OPENING",e.READY_CURRENTNO="READY_CURRENTNO",e.GAME_READY_TO_ANNOUNCE="GAME_READY_TO_ANNOUNCE",e.TURNTABLE_ANIMATION_END="TURNTABLE_ANIMATION_END",e.READY_RESULT="READY_RESULT",e.MYMOVINGTIPANIMATIONEND="MYMOVINGTIPANIMATIONEND",e.MOVINGTIPANIMATIONEND="MOVINGTIPANIMATIONEND",e.SELF_BETTED="SELF_BETTED",e.MY_BETTING="MY_BETTING",e.EMPTY_MY_BETTING="EMPTY_MY_BETTING",e.COUNT_DOWN_END="COUNT_DOWN_END",e.READY_TURANTABLE="READY_TURANTABLE",e.REQUIRE_FORCE_LOGIN="REQUIRE_FORCE_LOGIN",e.SCREENOFF="SCREENOFF",e.BACKSTAKE="BACKSTAKE",e.BACKSTAKEAMOUNT="BACKSTAKEAMOUNT",e.ALREADY_LOGIN="ALREADY_LOGIN",e.UPDATEHISTORY="UPDATEHISTORY",e.SENDMYMOVINGTIP="SENDMYMOVINGTIP",e.CHOOSEBUTTONCLICK="CHOOSEBUTTONCLICK",e.START_OPEN_AWARD="START_OPEN_AWARD",e.SOCKET_PIPLE_READY="SOCKET_PIPLE_READY",e.COMMON_ERR_THROW="COMMON_ERR_THROW",e.ALREADY_GET_OPEN_INFO="ALREADY_GET_OPEN_INFO",e.ALREADY_GET_USER_RESULT="ALREADY_GET_USER_RESULT",e.INIT_USER_STAKE="INIT_USER_STAKE",e.USER_WIN="USER_WIN",e.NO_NET_WORK="NO_NET_WORK"}(GlobalEvent||(GlobalEvent={}));var FetchManager;!function(e){var t=!1,n="eyJ2IjozLCJnIjpmYWxzZSwidSI6IjExMzUzNDk5MCIsInQiOjE1MTMxNTU0NTk3NDgsInMiOiJ3eCIsImMiOiIxIiwiciI6IjU0NTJkcTE1aWZJdXg0UDAwZ0p6IiwiYSI6Ijk5NDUwMDE2RDFCMzEwMjBERjU2N0U0MDA1NTAyNUMzIiwibCI6IjIxOUJGRUExQjk5MTVENkVEQkREQTdDMjlFNDAzMjYwIn0",o=function(){var e="003",t=location.href.split("?")[1];return t&&-1!=t.indexOf("channel")&&t.split("&").forEach(function(t){0==t.indexOf("channel")&&(e=t.split("=")[1])}),e}();Pxfetch.fetchPrefilter(function(e){e.data.channel=o,e.url.search("auth")>0&&e.url.search("unauth")<0&&(Native.isLogin()&&Native.getTokenFromCache()?(e.data.access_token=Native.getTokenFromCache(),e.data.imei=Native.getDeviceInfo().i):Native.getToken(function(e){},!0))}),Pxfetch.fetchNetworkError(function(){t||NoNetWork.noNetWork(function(){ProcessManager.init()},!0),t=!0}),Pxfetch.fetchError(function(e){/^5/.test(e.status)?Native.showNativeDialog({title:"系统繁忙，稍后重试",positiveText:"退出",negativeText:"",cancelable:!1},Native.finishPage):401==e.status&&(Native.getTokenFromCache()===n||Native.getToken(function(e){},!0))}),Pxfetch.fetchSuccess(function(e,t){GameInfo.isInterrupted&&(t.success=null,t.timeoutError=null)}),GlobalEmitter.on(GlobalEvent.COMMON_ERR_THROW,function(e){"120203"==e.code?Native.showNativeDialog({title:"120203",positiveText:"退出",negativeText:"",cancelable:!1},Native.finishPage):"110101"==e.code&&Native.getToken(function(e){},!0)},e)}(FetchManager||(FetchManager={}));var OpenAwardInfo=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/turntableLayout/openAwardInfo.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){GlobalEmitter.on(GlobalEvent.START_OPEN_AWARD,this.openAward,this),GlobalEmitter.on(GlobalEvent.READY_CURRENTNO,this.initGameInfo,this)},t.prototype.openAward=function(e,t){if(e=t.userWinInfo&&t.userWinInfo.totalAmount&&t.userWinInfo.totalAmount>0?!0:!1)if(t.userWinInfo&&t.userWinInfo.payoff&&t.userWinInfo.payoff>0)this.currentState="win",this.win_coin.text="赢得"+t.userWinInfo.payoff+"金豆",this.openLightAnim(),GlobalEmitter.emit(GlobalEvent.USER_WIN,t.userWinInfo.payoff);else{this.currentState="noWin";var n;n=t.userWinInfo.stakeInfo.map(function(e){return e.result.desc});for(var o in n)this.setMyBetType(n[o])}else this.currentState="noBet",this.no_bet_label1.text="本轮"+t.result.userCount+"位玩家",this.no_bet_label2.text="共赢"+t.result.totalAmount+"金豆"},t.prototype.openLightAnim=function(){egret.Tween.get(this.win_light,{loop:!0}).set({source:RES.getRes("win_light1_png")}).wait(200).set({source:RES.getRes("win_light2_png")}).wait(200)},t.prototype.initGameInfo=function(){egret.Tween.removeTweens(this.win_light),this.no_win_tip.removeChildren();var e=new eui.Label;e.text="我的投注：",e.size=48,this.no_win_tip.addChild(e)},t.prototype.setMyBetType=function(e){if("元宝"==e||"砖石"==e){console.log("imgimg");var t=new eui.Image;"元宝"==e?t.source=RES.getRes("crown_png"):t.source=RES.getRes("diamond_png"),t.height=48,t.width=48,this.no_win_tip.addChild(t)}else{var n=new eui.Label;n.text=e,n.size=48,this.no_win_tip.addChild(n)}},t}(eui.Component);__reflect(OpenAwardInfo.prototype,"OpenAwardInfo");var Header=function(){function e(){document.querySelector(".fm-header-lift").addEventListener("click",function(){console.log(Native),Native.finishPage()})}return e}();__reflect(Header.prototype,"Header");var Order=function(){function e(){this.active=!1,this.init()}return e.prototype.init=function(){var e=document.querySelector(".fm-header-right"),t=document.querySelector(".order_cover");e&&t&&(e.addEventListener("click",this.clickOrder.bind(this)),t.addEventListener("click",function(){this.active&&this.clickOrder()}.bind(this)))},e.prototype.clickOrder=function(){var e=this;document.querySelector(".orderLoading");return Native.isLogin().isLogin?void(e.active?e.closePanel():e.showPanel()):void Native.getToken(function(e){},!0)},e.prototype.showPanel=function(){var e=this;e.closePanel();var t=document.querySelector(".orderLoading"),n=document.querySelector(".order_cover"),o=document.querySelector(".order_box");e.active=!0,window.global_orderUpAndDowm=function(){e.closePanel()},Native.bindBackListener(window.global_orderUpAndDowm),t.style.display="block",n.style.display="block",o.style.transform=" translate3d(0, -119.4444vw, 0)"},e.prototype.closePanel=function(){var e=this,t=document.querySelector(".order_cover"),n=document.querySelector(".order_box");e.active=!1,window.global_orderUpAndDowm&&(Native.unBindBackListener(window.global_orderUpAndDowm),delete window.global_orderUpAndDowm),n.style.transform="translate3d(0, 0, 0)",t.style.display="none",n.innerHTML='<div class="orderLoading">正在加载中...</div>'},e}();__reflect(Order.prototype,"Order");var HistoryLayout=function(e){function t(){var t=e.call(this)||this;return t.factorComponent=null,t.groupWidth=0,t.groupHeight=0,t.updateCount=0,t.factorComponent=new eui.Component,t.factorComponent.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.factorComponent.skinName="resource/customSkins/historyLayout/historyLayout.exml",t.addChild(new eui.Image(RES.getRes("historyLayoutBG_png"))),t.addChild(t.factorComponent),t}return __extends(t,e),t.prototype.uiCompHandler=function(){this.groupWidth=this.factorComponent.$children[0].width,this.groupHeight=this.factorComponent.$children[0].height,GlobalEmitter.on(GlobalEvent.NEW_GAME_OPENING,function(){var e=this;WebsocketService.getRouletteHistory(function(t){t.value.forEach(function(t,n){switch(t.hits[0]){case 7:e.factorComponent.$children[n].$children[0].alpha=0,e.factorComponent.$children[n].$children[1].alpha=1;break;case 6:e.factorComponent.$children[n].$children[0].alpha=0,e.factorComponent.$children[n].$children[1].alpha=1;break;case 1:e.factorComponent.$children[n].$children[0].text="2";break;case 2:e.factorComponent.$children[n].$children[0].text="4";break;case 3:e.factorComponent.$children[n].$children[0].text="7";break;case 4:e.factorComponent.$children[n].$children[0].text="12";break;case 5:e.factorComponent.$children[n].$children[0].text="25"}})})},this),GlobalEmitter.on(GlobalEvent.UPDATEHISTORY,function(e){this.updateHistory(e)},this)},t.prototype.updateHistory=function(e){this.updateCount++;var t=egret.Tween.get(this.factorComponent);t.to({x:this.factorComponent.x+this.groupWidth},200).call(function(){var t=this.factorComponent.$children[14];switch(this.factorComponent.$children.splice(0,0,t),e){case 7:t.$children[0].alpha=0,t.$children[1].alpha=1;break;case 6:t.$children[0].alpha=0,t.$children[2].alpha=1;break;case 1:t.$children[0].text="2";break;case 2:t.$children[0].text="4";break;case 3:t.$children[0].text="7";break;case 4:t.$children[0].text="12";break;case 5:t.$children[0].text="25"}t.x=-this.groupWidth*this.updateCount,t.y=-this.groupHeight;var n=egret.Tween.get(t);n.to({y:0},200).call(function(){this.factorComponent.$children[1].$children[3].alpha=0,t.$children[3].alpha=1},this)},this)},t}(eui.Component);__reflect(HistoryLayout.prototype,"HistoryLayout");var Home=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/homeLayout/home.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){GlobalEmitter.on(GlobalEvent.NEW_GAME_OPENING,function(e){Native.isLogin()&&Native.getTokenFromCache()?(console.log(2222,1111),WebsocketService.getRouletteInitInfo(function(t){console.log(t.value,1111),e(t.value)})):WebsocketService.getCurrentGameInfo(function(t){console.log(t.value,2222),e(t.value)})},this)},t}(eui.Component);__reflect(Home.prototype,"Home");var NoNetWork=function(){function e(){}return e.noNetWork=function(e,t){var n=document.querySelector(".no-network-text"),o=document.querySelector(".no-network-cover");n.innerText=t?"无网络连接，请检查网络设置":"网络不稳定超时，请检查网络设置",GlobalEmitter.emit(GlobalEvent.NO_NET_WORK),o.style.display="block",window.no_network_callback=function(t){t.available&&window.no_network_callback&&(e(),o.style.display="none",Native.removeNetworkListener(window.no_network_callback),delete window.no_network_callback)},Native.addNetworkListener(window.no_network_callback),document.querySelector(".no-network").addEventListener("click",function(){location.href="flyme://com.meizu.compaign/bridgeLink?targetPackage=com.android.settings&targetAction=android.settings.SETTINGS"})},e}();__reflect(NoNetWork.prototype,"NoNetWork");var MovingTip=function(e){function t(){var t=e.call(this)||this;return t.factorText=0,t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/senderLayout/movingTip.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){},t.prototype.init=function(e,t){this.$children[1].text=e.toString(),this.factorText=t},t}(eui.Component);__reflect(MovingTip.prototype,"MovingTip");var Sender=function(e){function t(){var t=e.call(this)||this;return t.sectionArr=[],t.movingTipPool=null,t.timeId=0,t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/senderLayout/sender.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){var e=this;this.createMovingTip(),GlobalEmitter.on(GlobalEvent.READY_TURANTABLE,function(e){this.sectionArr=e},this),GlobalEmitter.on(GlobalEvent.READY_CURRENTNO,function(e,t,n){var o=this;this.timeId=window.setInterval(function(){WebsocketService.getCurrentStakeInfo(function(e){if(e.value.no==n.currentNo.no){o.$children[1].text=e.value.count;for(var t=0,i=Object.keys(e.value);t<i.length;t++){var r=i[t];"no"!=r&&"count"!=r&&e.value[r]>o.sectionArr[Number(r)-1].tipNum&&o.initMovingTip(o.sectionArr[Number(r)-1],e.value[r]-o.sectionArr[Number(r)-1].tipNum)}}else console.log(e.value.no,n.currentNo.no,"haha"),console.log("期号不对")})},5e3)},this),GlobalEmitter.on(GlobalEvent.GAME_READY_TO_ANNOUNCE,function(){window.clearInterval(this.timeId)},this),GlobalEmitter.on(GlobalEvent.SCREENOFF,function(){window.clearInterval(e.timeId)},this)},t.prototype.createMovingTip=function(){this.movingTipPool=new NodePool(MovingTip,30)},t.prototype.getMovingTipNum=function(e){for(var t=[20,50,100,500,1e3],n=0;n<t.length;n++){var o=t[n];if(8>=e/o)return{num:Math.floor(e/o),step:o}}return{num:Math.floor(e/t[t.length-1]),step:t[t.length-1]}},t.prototype.initMovingTip=function(e,t){for(var n=this.getMovingTipNum(t),o=[];n.num;){n.num--,t-=n.step;var i=this.movingTipPool.get();i.init(n.step,n.step),this.addChild(i),o.push(i)}if(t>0){var i=this.movingTipPool.get();i.init(t,t),this.addChild(i),o.push(i)}this.sendMovingTip(e,o)},t.prototype.sendMovingTip=function(e,t){var n=this;console.log(t.length,666),t.forEach(function(o,i){setTimeout(function(){var r=egret.Tween.get(o),s=e.localToGlobal(0,0),a=n.globalToLocal(s.x,s.y);i==t.length-1?r.to({x:a.x,y:a.y},200).call(function(i){o.visible=!1,GlobalEmitter.emit(GlobalEvent.MOVINGTIPANIMATIONEND,o.factorText,e.stakeId),t.forEach(function(e){this.movingTipPool.free(e)},n)}):r.to({x:a.x,y:a.y},200).call(function(t){o.visible=!1,GlobalEmitter.emit(GlobalEvent.MOVINGTIPANIMATIONEND,o.factorText,e.stakeId)})},100*i)})},t}(eui.Component);__reflect(Sender.prototype,"Sender");var CountDownTime=function(){function e(){this.SECOND=1e3,this.OFFSET=5,this.timer=document.querySelector(".count_down"),this.init()}return e.prototype.init=function(){GlobalEmitter.on(GlobalEvent.READY_CURRENTNO,function(e,t,n){console.log(n,"data999");var o=n.currentNo.stakeTimeLimit-0-(n.currentNo.timeOffset-0);1>o?(this.timer.innerHTML="正在开奖",e(o)):(this.timer.innerHTML=o+'"',this.secoundLoop(e,t,o,"START"))},this),GlobalEmitter.on(GlobalEvent.TURNTABLE_ANIMATION_END,function(e,t){this.secoundLoop(e,t,5,"END")},this),GlobalEmitter.on(GlobalEvent.SCREENOFF,this.clearSecondTimer,this)},e.prototype.secoundLoop=function(e,t,n,o){var i=this,r=n,s=Date.now(),a=Date.now(),l=this;l._askTime=l.SECOND,this._secoundLoopTimer=window.setInterval(function(){var t=Date.now(),c=t-s,u=t-a;u+50>=1e3*n?("START"==o&&(i.timer.innerHTML="正在开奖"),l.clearSecondTimer(),e(0)):(c>=l._askTime||c+5>=l._askTime)&&(s=t,l._askTime=l.SECOND-(c-l._askTime),r-=1,l.timer.innerHTML=""+("START"==o?"":"下一轮 ")+r+'"')},50)},e.prototype.clearSecondTimer=function(){this._secoundLoopTimer&&(window.clearInterval(this._secoundLoopTimer),delete this._secoundLoopTimer)},e}();__reflect(CountDownTime.prototype,"CountDownTime");var MyCoin=function(){function e(){this.capital=0,this.consume=0,this.openRechargeWindow=!1,this.myCoinNode=document.querySelector(".my_coin_count"),this.addCoinBtn=document.querySelector(".addCoin"),this.alreadyLogin=document.querySelector(".already_login"),this.readyLogin=document.querySelector(".ready_login"),this.init()}return e.prototype.initCoinWithData=function(e){var t=e.stakeInfo;if(this.consume=0,t)for(var n in t)this.consume+=t[n]-0;this.capital=e.amount-0+this.consume,this.showCoin()},e.prototype.addConsume=function(e){this.consume+=e,this.showCoin()},e.prototype.cutConsume=function(e){this.consume-=e,this.showCoin()},e.prototype.revertConsume=function(){this.consume=0,this.showCoin()},e.prototype.chargeCapital=function(e){this.capital=e-this.consume,this.showCoin()},e.prototype.userWin=function(e){this.capital+=e,this.showCoin()},e.prototype.init=function(){GlobalEmitter.on(GlobalEvent.ALREADY_LOGIN,function(){this.alreadyLogin.style.display="flex",this.readyLogin.style.display="none"},this),GlobalEmitter.on(GlobalEvent.MY_BETTING,function(e){console.log(e);var t=e.text-0;this.consume+t>this.capital?(e.func(!1),this.showChargeCoinWindow()):(this.addConsume(t),e.func(!0))},this),GlobalEmitter.on(GlobalEvent.EMPTY_MY_BETTING,function(){this.revertConsume()},this),GlobalEmitter.on(GlobalEvent.BACKSTAKEAMOUNT,function(e){this.cutConsume(e-0)},this),GlobalEmitter.on(GlobalEvent.USER_WIN,function(e){this.userWin(e-0)},this),GlobalEmitter.on(GlobalEvent.READY_CURRENTNO,function(e,t,n){this.initCoinWithData(n)},this),this.addCoinBtn.addEventListener("click",function(){Native.isLogin().isLogin?this.showChargeCoinWindow():Native.getToken(function(e){},!0)}.bind(this)),this.showCoin()},e.prototype.showCoin=function(){var e=this.capital-this.consume;this.myCoinNode.innerHTML=e+""},e.prototype.showChargeCoinWindow=function(){var e=this;e.openRechargeWindow||(e.openRechargeWindow=!0,window.global_chargeCoinCallback=function(t){e.openRechargeWindow=!1,delete window.global_chargeCoinCallback;var n=t.response;n&&n.data&&200==n.data.result&&WebsocketService.getUserCoin(function(t){e.chargeCapital(t.value-0)})}),location.href="flyme://com.meizu.compaign/coupon/dialog?resultCallback=global_chargeCoinCallback"},e}();__reflect(MyCoin.prototype,"MyCoin");var Rule=function(){function e(){this.active=!1,this.init()}return e.prototype.init=function(){var e=this,t=document.querySelector(".rule_btn"),n=document.querySelector(".rule_cover");t&&n&&(t.addEventListener("click",this.ruleBtnClick.bind(this)),n.addEventListener("click",function(){e.active&&e.ruleBtnClick()}))},e.prototype.ruleBtnClick=function(){var e=this;e.active?e.closeRuleBox():e.openRuleBox()},e.prototype.openRuleBox=function(){var e=this;e.closeRuleBox();var t=document.querySelector(".rule_cover"),n=document.querySelector(".rule_box");e.active=!0,window.global_setRuleBox=function(){e.closeRuleBox()},Native.bindBackListener(window.global_setRuleBox),t.style.display="block",n.style.transform="translate3d(0, -119.4444vw, 0)"},e.prototype.closeRuleBox=function(){var e=this,t=document.querySelector(".rule_cover"),n=document.querySelector(".rule_box");e.active=!1,window.global_setRuleBox&&(Native.unBindBackListener(window.global_setRuleBox),delete window.global_setRuleBox),t.style.display="none",n.style.transform="translate3d(0, 0, 0)"},e}();__reflect(Rule.prototype,"Rule");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isBGResourceLoadEnd=!1,t.progressCount=8,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause(),ProcessManager.stop(),GlobalEmitter.emit(GlobalEvent.SCREENOFF)},egret.lifecycle.onResume=function(){egret.ticker.resume(),ProcessManager.init()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),console.log("配置文件加载完成"),RES.loadGroup("home")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){switch(e.groupName){case"home":this.isBGResourceLoadEnd=!0,this.createScene();break;case"senderLayout":this.loadSenderLayout();break;case"chooseLayout":this.loadChooseLayout();break;case"turntableLayout":this.loadTurntableLayout();break;case"historyLayout":this.loadHistoryLayout()}},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isBGResourceLoadEnd&&this.startCreateScene()},t.prototype.loadChooseLayout=function(){var e=new Choose;this.homeUI.chooseLayout.addChild(e)},t.prototype.loadHistoryLayout=function(){var e=new HistoryLayout;this.homeUI.historyLayout.addChild(e)},t.prototype.loadTurntableLayout=function(){var e=new Turntable;this.homeUI.turntableLayout.addChild(e)},t.prototype.loadSenderLayout=function(){var e=new Sender;e.addEventListener(eui.UIEvent.ADDED,function(e){e.$target instanceof eui.Label&&RES.loadGroup("turntableLayout")},this),this.homeUI.senderLayout.addChild(e)},t.prototype.loadEntryLayout=function(){},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){Native.startLoading("正在初始化"+this.progressCount+"%(不消耗流量)"),this.progressCount+=4},t.prototype.startCreateScene=function(){this.homeUI=new Home,this.addChild(this.homeUI),this.homeUI.bottom=0,RES.loadGroup("chooseLayout"),RES.loadGroup("historyLayout"),RES.loadGroup("senderLayout"),new Order,new Rule,new CountDownTime,new Header,new NoNetWork,new MyCoin},t}(eui.UILayer);__reflect(Main.prototype,"Main");var Section=function(e){function t(){var t=e.call(this)||this;return t.myTip=null,t.myTipNum=0,t.tip=null,t.tipNum=0,t.stakeId=1,t.betting={amount:0,timeId:0},t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/turntableLayout/section.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){this.$children[0].$children[0];7==this.stakeId&&(GlobalEmitter.emit(GlobalEvent.READY_TURANTABLE,this.parent.$children),Native.setStatusbarStyle({isBlack:!1}),Native.stopLoading(),document.body.style.visibility="visible"),this.$stage&&(this.tip.visible=!1,this.myTip.visible=!1,this.listenCLick(),this.myMovingTipAnimationEnd(),this.movingTipAnimationEnd(),this.listenSelfBetted(),GlobalEmitter.on(GlobalEvent.BACKSTAKE,this.backStake,this),GlobalEmitter.on(GlobalEvent.NEW_GAME_OPENING,this.init,this))},t.prototype.init=function(){this.myTipNum=0,this.tipNum=0,this.myTip.$children[1].size=30,this.myTip.$children[1].text="0",this.tip.$children[1].text="0",this.myTip.visible=!1,this.tip.visible=!1},t.prototype.listenCLick=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;return Native.isLogin().isLogin?void new Promise(function(e,t){GlobalEmitter.emit(GlobalEvent.MY_BETTING,{text:GameInfo.chooseAmount,func:e})}).then(function(t){t?(GlobalEmitter.emit(GlobalEvent.SENDMYMOVINGTIP,e.localToGlobal(98,0),e.stakeId),e.betting.amount?e.betting.amount+=Number(GameInfo.chooseAmount):e.betting.amount=GameInfo.chooseAmount,e.betting.timeId||(e.betting.timeId=setTimeout(function(){clearTimeout(e.betting.timeId),e.betting.timeId=0;var t=e.betting.amount;WebsocketService.myBetting(e.stakeId,e.betting.amount,function(n){n?GlobalEmitter.emit(GlobalEvent.SELF_BETTED):e.backStake(t,e.stakeId)}),e.betting.amount=0},1e3))):console.log("金豆不足")}):void Native.getToken(function(e){},!0)},this)},t.prototype.myMovingTipAnimationEnd=function(){GlobalEmitter.on(GlobalEvent.MYMOVINGTIPANIMATIONEND,function(e,t){this.stakeId==t&&(this.setMyTipNum(e),this.myTip.visible||(this.myTip.visible=!0),this.setTipNum(e),this.tip.visible||(this.tip.visible=!0))},this)},t.prototype.setMyTipNum=function(e){this.myTipNum=Number(this.myTipNum)+Number(e),this.myTipNum>9980?this.myTip.$children[1].size=24:this.myTip.$children[1].size=30,this.myTip.$children[1].text=this.myTipNum.toString()},t.prototype.setTipNum=function(e){this.tipNum=Number(this.tipNum)+Number(e),this.tipNum>9980?this.tip.$children[1].text="1万+":this.tip.$children[1].text=this.tipNum.toString()},t.prototype.movingTipAnimationEnd=function(){GlobalEmitter.on(GlobalEvent.MOVINGTIPANIMATIONEND,function(e,t){this.stakeId==t&&(this.setTipNum(e),this.tip.visible||(this.tip.visible=!0))},this)},t.prototype.backStake=function(e,t){t&&this.stakeId==t&&(this.setTipNum(-e),this.tipNum<=0&&(this.tipNum=0,this.tip.visible=!1),this.setMyTipNum(-e),this.myTipNum<=0&&(this.myTipNum=0,this.myTip.visible=!1),GlobalEmitter.emit(GlobalEvent.BACKSTAKEAMOUNT,e)),e||(GlobalEmitter.emit(GlobalEvent.BACKSTAKEAMOUNT,this.myTipNum),this.setTipNum(-this.myTipNum),this.tipNum<=0&&(this.tipNum=0,this.tip.visible=!1),this.myTipNum=0,this.myTip.visible=!1)},t.prototype.listenSelfBetted=function(){GlobalEmitter.on(GlobalEvent.INIT_USER_STAKE,function(e){e[this.stakeId]&&(this.setTipNum(e[this.stakeId]),this.setMyTipNum(e[this.stakeId]),this.myTip.$children[1].text=this.myTipNum,this.tip.$children[1].text=this.tipNum,this.tip.visible||(this.tip.visible=!0),this.myTip.visible||(this.myTip.visible=!0))},this)},t}(eui.Component);__reflect(Section.prototype,"Section");var ProcessManager;!function(e){function t(){console.log(i,999),i||(s=!0,i=new WebsocketService,ServersEngine.addBroadCastLiseners(function(e){"/game/roulette/result"==e.type&&GlobalEmitter.emit(GlobalEvent.ALREADY_GET_OPEN_INFO,e)}),ServersEngine.globalSubscriSuccess(function(e){GlobalEmitter.emit(GlobalEvent.ALREADY_GET_USER_RESULT,e)}))}function n(){var n=this;new Promise(function(e,o){r=o,Native.isLogin().isLogin?(Native.getToken(function(n){t(),console.log(i,"websocketChannel",1),s?(GlobalEmitter.on(GlobalEvent.SOCKET_PIPLE_READY,function(){console.log(i,"websocketChannel",2),GlobalEmitter.emit(GlobalEvent.NEW_GAME_OPENING,e,o)},this),s=!1):(console.log(i,"websocketChannel",3),GlobalEmitter.emit(GlobalEvent.NEW_GAME_OPENING,e,o))},!1),GlobalEmitter.emit(GlobalEvent.ALREADY_LOGIN)):(t(),s?(GlobalEmitter.on(GlobalEvent.SOCKET_PIPLE_READY,function(){GlobalEmitter.emit(GlobalEvent.NEW_GAME_OPENING,e,o)},n),s=!1):GlobalEmitter.emit(GlobalEvent.NEW_GAME_OPENING,e,o)),console.log("NEW_GAME_OPENING事件触发",1)}).then(function(e){return new Promise(function(t,n){r=n,console.log("READY_CURRENTNO事件触发",2.1),GlobalEmitter.emit(GlobalEvent.READY_CURRENTNO,t,n,e),console.log("READY_CURRENTNO事件触发",2)})}).then(function(e){return new Promise(function(t,n){r=n,GlobalEmitter.emit(GlobalEvent.GAME_READY_TO_ANNOUNCE,t,n,e),console.log("GAME_READY_TO_ANNOUNCE事件触发",3)})}).then(function(){return new Promise(function(e,t){r=t,GlobalEmitter.emit(GlobalEvent.TURNTABLE_ANIMATION_END,e,t),console.log("TURNTABLE_ANIMATION_END事件触发",4)})}).then(function(){e.init(),console.log("新一轮事件触发",5)})["catch"](function(e){console.log("屏幕息屏",e)})}function o(){r&&(ServersEngine.disConnect(),i=null,r())}var i,r=null,s=!0;e.getWebsocketChannel=t,GlobalEmitter.on(GlobalEvent.SCREENOFF,function(){i=null},e),GlobalEmitter.on(GlobalEvent.NO_NET_WORK,function(){i=null},e),e.init=n,e.stop=o}(ProcessManager||(ProcessManager={}));var openInfo={isGetMyOpenInfo:!1,isGetCurrentRouletteResult:!1,number:null,result:null,userWinInfo:null},Turntable=function(e){function t(){var t=e.call(this)||this;return t.scrollCount=0,t.open=!1,t.isBet=!1,t.lastOpenId=0,t.IN_COUNT_DOWN_COUNT=0,t.SCREEN_IS_OFF=!1,t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/turntableLayout/turntable.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){this.openAward.addChild(new OpenAwardInfo),GlobalEmitter.on(GlobalEvent.ALREADY_GET_USER_RESULT,this.getUserStakeResultCallback,this),this.drawC(),GlobalEmitter.on(GlobalEvent.READY_CURRENTNO,function(e,t,n){this.IN_COUNT_DOWN_COUNT=n.currentNo.stakeTimeLimit-0-(n.currentNo.timeOffset-0),this.CURRENT_NO=n.currentNo.no,n.stakeInfo&&"{}"!=JSON.stringify(n.stakeInfo)?(this.isBet=!0,GlobalEmitter.emit(GlobalEvent.INIT_USER_STAKE,n.stakeInfo)):this.isBet=!1,this.newGameOpen(n)},this),GlobalEmitter.on(GlobalEvent.GAME_READY_TO_ANNOUNCE,function(e,t,n){this.countDownEnd(e,t,n)},this),GlobalEmitter.on(GlobalEvent.TURNTABLE_ANIMATION_END,function(e,t){this.lottery(e,t)},this),GlobalEmitter.on(GlobalEvent.SELF_BETTED,function(){this.isBet=!0},this),GlobalEmitter.on(GlobalEvent.BACKSTAKE,function(){this.isBet=!1},this),GlobalEmitter.on(GlobalEvent.SCREENOFF,this.screenOff,this),GlobalEmitter.on(GlobalEvent.ALREADY_GET_OPEN_INFO,function(e){e.value.no==this.CURRENT_NO?this.getCurrentLotteryResultCallback(e):console.log("请求的结果不是本期的结果，本期期号为"+this.CURRENT_NO+",开奖的期号为"+e.value.no)},this),ProcessManager.init()},t.prototype.countDownEnd=function(e,t,n){this.currentState="opening",this.startScroll(e,t,n),this.getOpenAwrad()},t.prototype.startScroll=function(e,t,n){var o=this,i=o.stopScrollTableTween();i.to({rotation:this.scrollTable.rotation+360},2e3,egret.Ease.sineIn).call(function(){o.middSrcollAnima(e,t,n)}),o.startLightAnmi()},t.prototype.middSrcollAnima=function(e,t,n){var o=this,i=0,r=4+n>1?4+n:1;o.scrollCount+=1,egret.Tween.removeTweens(this.scrollTable);var s=o.stopScrollTableTween();s.to({rotation:this.scrollTable.rotation+360},1e3).call(function(){if(o.scrollCount>r&&openInfo.isGetCurrentRouletteResult&&openInfo.isGetMyOpenInfo){var s=openInfo.number;i=o.lastOpenId>s?54+s-o.lastOpenId:s-o.lastOpenId,console.log(i,"angle"),27>i&&(i+=54),console.log(o.lastOpenId,s,"self.lastOpenId > currentPanId",i),o.lastOpenId=s,o.endScrollAnima(i,e,t)}else o.middSrcollAnima(e,t,n)})},t.prototype.endScrollAnima=function(e,t,n){var o=this,i=o.stopScrollTableTween(),r=2500*e/27;i.to({rotation:this.scrollTable.rotation+20*e/3},r,egret.Ease.circOut).call(function(){GlobalEmitter.emit(GlobalEvent.UPDATEHISTORY,openInfo.result.hits[0]),t()})},t.prototype.getOpenAwrad=function(){var e=this;e.open=!0,this.isBet||(openInfo.isGetMyOpenInfo=!0),e.IN_COUNT_DOWN_COUNT-0<3&&(this.isBet&&WebsocketService.getUserStakeResult(function(e){200==e.code&&(openInfo.isGetMyOpenInfo=!0,openInfo.userWinInfo=e.value)}),console.log(e.IN_COUNT_DOWN_COUNT,"self.IN_COUNT_DOWN_COUNT"),WebsocketService.getCurrentLotteryResult(function(t){e.getCurrentLotteryResultCallback(t)}))},t.prototype.getUserStakeResultCallback=function(e){"/game/roulette/user_stake_result"==e.type&&(console.log(e,"getUserStakeResultCallback"),openInfo.isGetMyOpenInfo=!0,openInfo.userWinInfo=e.value)},t.prototype.getCurrentLotteryResultCallback=function(e){var t=this;if(200==e.code){console.log(e,"开奖了");var n=e.value;!n&&t.IN_COUNT_DOWN_COUNT-0<3?WebsocketService.getCurrentLotteryResult(function(e){t.getCurrentLotteryResultCallback(e)}):(openInfo.isGetCurrentRouletteResult=!0,openInfo.number=n.numbers[0],openInfo.result=n,Native.markCoinChanged())}},t.prototype.lottery=function(e,t){var n=this,o=setTimeout(function(){n.SCREEN_IS_OFF||(n.currentState="close"),clearTimeout(o)},1e3);this.countLotteryResult(),n.endLightAnmi()},t.prototype.stopScrollTableTween=function(){return egret.Tween.removeTweens(this.scrollTable),egret.Tween.get(this.scrollTable)},t.prototype.countLotteryResult=function(){GlobalEmitter.emit(GlobalEvent.START_OPEN_AWARD,this.isBet,openInfo)},t.prototype.newGameOpen=function(e){this.scrollCount=0,this.open=!1,this.SCREEN_IS_OFF=!1,this.currentState="open";var t=this.lastOpenId;this.lastOpenId=e.lastHitNumber[0],this.scrollTable.rotation+=20*(this.lastOpenId-t)/3,this.scrollTable.rotation%=360,openInfo={isGetMyOpenInfo:!1,isGetCurrentRouletteResult:!1,number:null,result:null,userWinInfo:null}},t.prototype.startLightAnmi=function(){egret.Tween.get(this.light,{loop:!0}).set({source:RES.getRes("wrapcircle_bg2_png")}).wait(300).set({source:RES.getRes("wrapcircle_bg_png")}).wait(200),egret.Tween.get(this.light1,{loop:!0}).set({source:RES.getRes("wrapcircle_bg2_png")}).wait(300).set({source:RES.getRes("wrapcircle_bg_png")}).wait(200)},t.prototype.endLightAnmi=function(){egret.Tween.removeTweens(this.light),egret.Tween.removeTweens(this.light1)},t.prototype.drawC=function(){var e=new egret.Shape;e.graphics.beginFill(0,.8),e.graphics.drawCircle(400,400,350),e.graphics.endFill(),this.openingCover.addChild(e)},t.prototype.screenOff=function(){egret.Tween.removeTweens(this.scrollTable),egret.Tween.removeTweens(this.light),egret.Tween.removeTweens(this.light1),this.SCREEN_IS_OFF=!0
},t}(eui.Component);__reflect(Turntable.prototype,"Turntable");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?o(i):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GameInfo;!function(e){e.isInterrupted=!1,GlobalEmitter.on(GlobalEvent.SCREENOFF,function(){e.isInterrupted=!0},FetchManager),GlobalEmitter.on(GlobalEvent.NEW_GAME_OPENING,function(){e.isInterrupted=!1},FetchManager),e.chooseAmount=20,GlobalEmitter.on(GlobalEvent.CHOOSEBUTTONCLICK,function(t){e.chooseAmount=Number(t)},FetchManager),e.ableStake=!0,GlobalEmitter.on(GlobalEvent.NEW_GAME_OPENING,function(){e.ableStake=!0},FetchManager),GlobalEmitter.on(GlobalEvent.GAME_READY_TO_ANNOUNCE,function(){e.ableStake=!1},FetchManager)}(GameInfo||(GameInfo={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var CURRENT_NO=void 0,ServerDomain="https://venice.uwaterpark.com",OVER_STAKE_TIME="120301",NEW_ISSUE_UN_OPEN="120302",MULTI_ACCOUNT_ERR="120303",RISK_ERROR="120304",MULTI_ACCOUNT_ERR_WORDING="检测到你的账号在其他设备上登录，请退出稍后重试",__interrupted=!1,RequestTimeOut=5e3,MaxRetry=3,newIssueUnOpenTime=0,betMemory={mark:function(){this._=!0},clear:function(){this._=!1},isEverBet:function(){return!!this._}},FetchService=function(){function e(){this.newIssueUnOpenTime=0}return e.getRouletteInitInfo=function(e){var t=this;betMemory.clear();var n="__getInitData_timeout",o=this;Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/auth/game/roulette/init.do",data:{},success:function(i,r){if(t[n]=0,i.code==NEW_ISSUE_UN_OPEN)newIssueUnOpenTime=newIssueUnOpenTime?newIssueUnOpenTime+1:1,newIssueUnOpenTime&&newIssueUnOpenTime>30?Native.showNativeDialog({title:"游戏场次异常，请退出稍后重试",positiveText:"退出",negativeText:""},Native.finishPage):o.getRouletteInitInfo(e);else{var s=i.value,a=s.currentNo.no;newIssueUnOpenTime=0,CURRENT_NO=a,e(i)}}})},e.getCurrentGameInfo=function(e){betMemory.clear();var t="__getCurrentNo_timeout",n=this;Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/unauth/game/roulette/unauth_init.do",data:{},success:function(o){n[t]=0;var i=o.value;o.code==NEW_ISSUE_UN_OPEN?(newIssueUnOpenTime=newIssueUnOpenTime?newIssueUnOpenTime+1:1,newIssueUnOpenTime&&newIssueUnOpenTime>30?Native.showNativeDialog({title:"游戏场次异常，请退出稍后重试",positiveText:"退出",negativeText:""},Native.finishPage):n.getCurrentGameInfo(e)):(newIssueUnOpenTime=0,CURRENT_NO=i.no,e(o))}})},e.emptyMyBetting=function(e){Pxfetch.pxfetch({type:"post",url:ServerDomain+"/native/auth/game/roulette/clear_stake.do",data:{},success:function(t){200==t.code?(betMemory.clear(),e(t)):t.code==MULTI_ACCOUNT_ERR&&Native.showNativeDialog({title:MULTI_ACCOUNT_ERR_WORDING,positiveText:"退出",negativeText:""},Native.finishPage)}})},e.myBetting=function(e,t,n){Pxfetch.pxfetch({type:"post",url:ServerDomain+"/native/auth/game/roulette/stake.do",data:{stakeId:e,amount:t},success:function(e){200==e.code?(betMemory.mark(),n(e)):e.code==MULTI_ACCOUNT_ERR?Native.showNativeDialog({title:MULTI_ACCOUNT_ERR_WORDING,positiveText:"退出",negativeText:"",cancelable:!1},Native.finishPage):e.code==RISK_ERROR&&(n(!1),Native.showNativeToast({message:"系统繁忙，投注失败",duration:1}))}})},e.getMyStakeInfo=function(e){var t="__getSelfBettingInfo_timeout",n=this;Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/auth/game/roulette/stake_info.do",data:{no:CURRENT_NO},success:function(o){n[t]=0,e(o)},timeoutError:function(){(n[t]=n[t]?n[t]+1:1)<MaxRetry?n.getMyStakeInfo(e):(n[t]=0,NoNetWork.noNetWork(function(){ProcessManager.init()},!1))}},RequestTimeOut)},e.getUserStakeResult=function(e){var t="__getUserStakeResult_timeout",n=this;Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/auth/game/roulette/user_stake_result.do",data:{no:CURRENT_NO},success:function(o){n[t]=0,e(o)},timeoutError:function(){(n[t]=n[t]?n[t]+1:1)<MaxRetry?n.getUserStakeResult(e):(n[t]=0,NoNetWork.noNetWork(function(){ProcessManager.init()},!1))}},RequestTimeOut)},e.getRouletteHistory=function(e){var t="__getHistory_timeout",n=this;Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/unauth/game/roulette/history.do",data:{offset:"",size:20},success:function(o){n[t]=0,e(o)},timeoutError:function(){(n[t]=n[t]?n[t]+1:1)<MaxRetry?n.getRouletteHistory(e):(n[t]=0,NoNetWork.noNetWork(function(){ProcessManager.init()},!1))}},RequestTimeOut)},e.getCurrentLotteryResult=function(e){var t="__getCurrentLotteryResult_timeout",n=this;Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/unauth/game/roulette/result.do",data:{no:CURRENT_NO},success:function(t){if(200==t.code)e(t);else var o=setTimeout(function(){clearTimeout(o),n.getCurrentLotteryResult(e)},200)},timeoutError:function(){(n[t]=n[t]?n[t]+1:1)<MaxRetry?n.getRouletteHistory(e):(n[t]=0,NoNetWork.noNetWork(function(){},!1))}},RequestTimeOut)},e.getCurrentStakeInfo=function(e){var t=CURRENT_NO;t&&Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/unauth/game/roulette/stake_info.do",data:{no:t},success:function(n){t==CURRENT_NO&&e(n)}})},e.getStakeTableInfo=function(e){Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/unauth/game/roulette/stake_table.do",data:{},success:function(t){200==t.code&&e(t)}})},e.getUserIsBet=function(){return betMemory.isEverBet()},e.getUserOrder=function(e,t,n){Pxfetch.pxfetch({type:"get",url:ServerDomain+"/native/auth/game/roulette/full_user_record.do",data:{page:e,size:t},success:function(e){200==e.code&&n(e)}})},e}();__reflect(FetchService.prototype,"FetchService");var Choose=function(e){function t(){var t=e.call(this)||this;return t.emptyButton=null,t.chooseButtonArr=null,t.myMovingTipStart={point:null,text:null},t.myMovingTipPool=null,t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/chooseLayout/choose.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){var e=this;this.emptyButton=this.$children[0],this.chooseButtonArr=this.$children.slice(1),this.emptyButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){GameInfo.ableStake&&this.backAllStake()},this),this.chooseButtonArr.forEach(function(t,n){t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.chooseButtonClickCallBack(t,n),GlobalEmitter.emit(GlobalEvent.CHOOSEBUTTONCLICK,t.name)},e)});var t=localStorage.getItem("turntableChooseButtonIndex");t?this.chooseButtonArr[t].dispatchEventWith(egret.TouchEvent.TOUCH_TAP):this.chooseButtonArr[0].dispatchEventWith(egret.TouchEvent.TOUCH_TAP),GlobalEmitter.on(GlobalEvent.SENDMYMOVINGTIP,function(t,n){e.sendMyMovingTip(t,n)},this),GlobalEmitter.on(GlobalEvent.GAME_READY_TO_ANNOUNCE,function(){this.backEmptyButtonStyle(),this.destoryMyMovingTipPool()},this),this.createMyMovingTipPool()},t.prototype.backAllStake=function(){var e=this;WebsocketService.emptyMyBetting(function(t){console.log("清空接口正常",t),e.backEmptyButtonStyle(),GlobalEmitter.emit(GlobalEvent.BACKSTAKE)})},t.prototype.backEmptyButtonStyle=function(){this.emptyButton.$children[1].alpha=.4},t.prototype.chooseButtonClickCallBack=function(e,t){this.chooseButtonArr.forEach(function(e){1.25===e.scaleX&&(e.scaleX=1,e.scaleY=1)}),e.scaleX=1.25,e.scaleY=1.25,this.myMovingTipStart.point={x:e.x,y:e.y},this.myMovingTipStart.text=e.name,localStorage.setItem("turntableChooseButtonIndex",t.toString())},t.prototype.createMyMovingTipPool=function(){this.myMovingTipPool||(this.myMovingTipPool=new NodePool(MyMovingTip,10))},t.prototype.sendMyMovingTip=function(e,t){var n=this.myMovingTipPool.get();this.addChild(n),n.init(this.myMovingTipStart.point,this.myMovingTipStart.text);var o=egret.Tween.get(n),i=this.globalToLocal(e.x,e.y);o.to({x:i.x,y:i.y},200).call(function(){this.myMovingTipPool.free(n),this.removeChild(n),GlobalEmitter.emit(GlobalEvent.MYMOVINGTIPANIMATIONEND,this.myMovingTipStart.text,t),.4==this.emptyButton.$children[1].alpha&&(this.emptyButton.$children[1].alpha=1)},this)},t.prototype.destoryMyMovingTipPool=function(){this.myMovingTipPool.restore()},t}(eui.Component);__reflect(Choose.prototype,"Choose");var MyMovingTip=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/customSkins/chooseLayout/myMovingTip.exml",t.enabled=!1,t}return __extends(t,e),t.prototype.uiCompHandler=function(){},t.prototype.init=function(e,t){this.x=e.x,this.y=e.y,this.$children[1].text=t},t}(eui.Component);__reflect(MyMovingTip.prototype,"MyMovingTip");var NodePool=function(){function e(e,t){this.Node=null,this.max=0,this.pool={free:[],busy:[]},this.Node=e,this.max=t,this.init()}return Object.defineProperty(e.prototype,"length",{get:function(){return this.pool.free.length+this.pool.busy.length},enumerable:!0,configurable:!0}),e.prototype.init=function(){for(var e=0;e<this.max;e++)this.pool.free.push(new this.Node)},e.prototype.get=function(){if(this.pool.free.length>0){var e=this.pool.free.pop();return this.pool.busy.push(e),e}var t=new this.Node;return this.max++,this.pool.busy.push(t),t},e.prototype.free=function(e){var t=this.pool.busy.indexOf(e);t>-1&&(this.pool.busy.splice(t,1),this.pool.free.unshift(e))},e.prototype.destory=function(e){e&&e(this.pool),this.max=0,this.pool.free=[],this.pool.busy=[]},e.prototype.restore=function(){var e=this;this.pool.busy.forEach(function(t){e.free(t)})},e}();__reflect(NodePool.prototype,"NodePool");var ServersEngine=function(){function e(){}return e.initial=function(){var e=this;StompWebSocket.initial(function(){e.networkError||console.log(" 通知网络异常 todo"),e.networkError=!0},{120203:"多设备登录",110101:"访问该接口需要用户登陆信息"},function(e){GlobalEmitter.emit(GlobalEvent.COMMON_ERR_THROW,e),console.log(e,"error")},function(e){console.log(e,"nidaye"),GlobalEmitter.emit(GlobalEvent.SOCKET_PIPLE_READY,e)},this.checkLoginWithXhr.bind(this),this.AUTH_LINK_URL_PREFIX,this.UN_AUTH_LINK_URL,this.SERVER_DOMAIN)},e.checkLoginWithXhr=function(e,t,n){Pxfetch.pxfetch({type:"get",url:this.SERVER_DOMAIN+"/native/auth/user/info.do",data:t,success:function(e){200==e.code?n():console.log("error",e.message)}},5e3)},e.disConnect=function(){StompWebSocket.disConnect()},e.connect=function(){this.networkError=!1;var e;!!Native.isLogin().isLogin&&(e=Native.getTokenFromCache()),StompWebSocket.connect(e,Native.getDeviceInfo())},e.sendMessage=function(e,t,n){void 0===n&&(n=null),StompWebSocket.sendMessage(e,t,n)},e.addBroadCastLiseners=function(e){StompWebSocket.addBroadCastLiseners(e)},e.globalSubscriSuccess=function(e){StompWebSocket.globalSubscriSuccess(e)},e.AUTH_LINK_URL_PREFIX="ws://venice.uwaterpark.com:8081/native/auth/sock",e.UN_AUTH_LINK_URL="ws://venice.uwaterpark.com:8081/web/unauth/sock",e.SERVER_DOMAIN="https://venice.uwaterpark.com",e.networkError=!1,e.CHANNEL=function(){var e="003",t=location.href.split("?")[1];return t&&-1!=t.indexOf("channel")&&t.split("&").forEach(function(t){0==t.indexOf("channel")&&(e=t.split("=")[1])}),e}(),e}();__reflect(ServersEngine.prototype,"ServersEngine");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function i(e){t.call(o,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(o))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CURRENT_NO=-1,ServerDomain="https://venice.uwaterpark.com",OVER_STAKE_TIME="120301",NEW_ISSUE_UN_OPEN="120302",MULTI_ACCOUNT_ERR="120303",RISK_ERROR="120304",MULTI_ACCOUNT_ERR_WORDING="检测到你的账号在其他设备上登录，请退出稍后重试",__interrupted=!1,RequestTimeOut=5e3,MaxRetry=3,newIssueUnOpenTime=0,WebsocketService=function(){function e(){this.newIssueUnOpenTime=0,ServersEngine.initial(),ServersEngine.connect()}return e.getRouletteInitInfo=function(e){var t="__getInitData_timeout",n=this;ServersEngine.sendMessage("/req/game/roulette/init","",function(o){if(console.log(o,885588),n[t]=0,o.code==NEW_ISSUE_UN_OPEN)newIssueUnOpenTime=newIssueUnOpenTime?newIssueUnOpenTime+1:1,newIssueUnOpenTime&&newIssueUnOpenTime>30?Native.showNativeDialog({title:"游戏场次异常，请退出稍后重试",positiveText:"退出",negativeText:""},Native.finishPage):n.getRouletteInitInfo(e);else{var i=o.value,r=i.currentNo.no;newIssueUnOpenTime=0,CURRENT_NO=r,console.log(o,"startGame"),e(o)}})},e.getCurrentGameInfo=function(e){var t="__getCurrentNo_timeout",n=this;ServersEngine.sendMessage("/req/game/roulette/unauth_init","",function(o){n[t]=0;var i=o.value;o.code==NEW_ISSUE_UN_OPEN?(newIssueUnOpenTime=newIssueUnOpenTime?newIssueUnOpenTime+1:1,newIssueUnOpenTime&&newIssueUnOpenTime>30?Native.showNativeDialog({title:"游戏场次异常，请退出稍后重试",positiveText:"退出",negativeText:""},Native.finishPage):n.getCurrentGameInfo(e)):(newIssueUnOpenTime=0,CURRENT_NO=i.no,e(o))})},e.emptyMyBetting=function(e){ServersEngine.sendMessage("/req/game/roulette/clear_stake",JSON.stringify({channel:"03"}),function(t){console.log("清注"),200==t.code?e(t):t.code==MULTI_ACCOUNT_ERR&&Native.showNativeDialog({title:MULTI_ACCOUNT_ERR_WORDING,positiveText:"退出",negativeText:""},Native.finishPage)})},e.myBetting=function(e,t,n){console.log("下注了",t),ServersEngine.sendMessage("/req/game/roulette/stake",JSON.stringify({stakeId:e,amount:t}),function(e){console.log(e,"myBeting"),200==e.code?n(e):(n(!1),e.code==MULTI_ACCOUNT_ERR?Native.showNativeDialog({title:MULTI_ACCOUNT_ERR_WORDING,positiveText:"退出",negativeText:"",cancelable:!1},Native.finishPage):e.code==RISK_ERROR&&Native.showNativeToast({message:"系统繁忙，投注失败",duration:1}))})},e.getMyStakeInfo=function(e){var t="__getSelfBettingInfo_timeout",n=this;ServersEngine.sendMessage("/req/game/roulette/stake_info",JSON.stringify({no:CURRENT_NO}),function(o){n[t]=0,e(o)})},e.getUserStakeResult=function(e){ServersEngine.sendMessage("/req//game/roulette/user_stake_result",JSON.stringify({no:CURRENT_NO}),function(t){e(t)})},e.getRouletteHistory=function(e){var t="__getHistory_timeout",n=this;ServersEngine.sendMessage("/req/game/roulette/dice_history",JSON.stringify({offset:0,size:15}),function(o){n[t]=0,e(o)})},e.getCurrentLotteryResult=function(e){ServersEngine.sendMessage("/req/game/roulette/dice_result",JSON.stringify({no:CURRENT_NO}),function(t){200==t.code&&e(t)})},e.getCurrentStakeInfo=function(e){var t=CURRENT_NO;t&&ServersEngine.sendMessage("/req/game/roulette/all_stake_info",JSON.stringify({no:t}),function(n){t==CURRENT_NO&&e(n)})},e.getStakeTableInfo=function(e){ServersEngine.sendMessage("/req/game/roulette/stake_table","",function(t){200==t.code&&e(t)})},e.getUserCoin=function(e){ServersEngine.sendMessage("/req/coin/amount","",function(t){200==t.code&&e(t)})},e}();__reflect(WebsocketService.prototype,"WebsocketService");